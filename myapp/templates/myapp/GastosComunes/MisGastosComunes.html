{% extends 'myapp/base.html' %}
{% block contenido %}
{% load static %}
{% load humanize %}
<link rel="stylesheet" href="{% static 'myapp/css/PagarGastoComun/PagarGastoComun.css' %}">

<div class="titulo">
    <h1>
        {% if not user.is_staff %}
        MIS
        {% endif %}
         GASTOS COMUNES</h1>
</div>

<div style=" display: flex; align-items: center; justify-content: center; margin-top: 50px;">
    {% if user.is_staff %}
    <a style="color: #e9f4fb; outline: none; background-color: #1b3039; border-radius: 20px; padding: 10px 10px 10px; text-decoration: none; " 
    href="{% url 'CrearGastoComun' %}">+ Gasto común
    </a>
    {% endif %}
</div>

<div class="tabla">
    <table class="Residentes">
        <thead class="thead">
            <tr style="color: #eceff1;">
                <th>Fecha</th>
                <th>Monto</th>
                {% if not user.is_staff %}
                <th>Pagar</th>
                <th>Estado</th>
                {% endif %}
                {% if user.is_staff %}
                <th>Información</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for entity in entity %}
            <tr>
                <th>{{ entity.fecha }}</th>
                <th>${{ entity.monto }}</th>
                {% if not user.is_staff %}
                <th><a  data-bs-toggle="modal" data-bs-target="#exampleModal" href="#"><button>Pagar</button></a></th>
                <th>{{ entity.estado_pago }}</th>
                {% endif %}
            </tr>
            {% empty %}
            <h1>No tienes gastos comunes.</h1>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Elija el metodo de pago</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="paypal-button-container"></div>
            </div>
        </div>
    </div>
</div>

<div>
    {% include 'myapp/Paginator.html' %}

</div>
<script>
    paypal.Buttons({
      // Order is created on the server and the order id is returned
      createOrder() {
        return fetch("/my-server/create-paypal-order", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          // use the "body" param to optionally pass additional order information
          // like product skus and quantities
          body: JSON.stringify({
            cart: [
              {
                sku: "YOUR_PRODUCT_STOCK_KEEPING_UNIT",
                quantity: "YOUR_PRODUCT_QUANTITY",
              },
            ],
          }),
        })
        .then((response) => response.json())
        .then((order) => order.id);
      },
      // Finalize the transaction on the server after payer approval
      onApprove(data) {
        return fetch("/my-server/capture-paypal-order", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            orderID: data.orderID
          })
        })
        .then((response) => response.json())
        .then((orderData) => {
          // Successful capture! For dev/demo purposes:
          console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
          const transaction = orderData.purchase_units[0].payments.captures[0];
          alert(`Transaction ${transaction.status}: ${transaction.id}\n\nSee console for all available details`);
          // When ready to go live, remove the alert and show a success message within this page. For example:
          // const element = document.getElementById('paypal-button-container');
          // element.innerHTML = '<h3>Thank you for your payment!</h3>';
          // Or go to another URL:  window.location.href = 'thank_you.html';
        });
      }
    }).render('#paypal-button-container');
  </script>

{% endblock %}